<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Multiply Magic | Nily Playhouse</title>
  <meta name="theme-color" content="#2d9cdb" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Multiply Magic" />
  <link rel="icon" type="image/png" href="favicon.png" />
  <link rel="apple-touch-icon" href="apple-touch-icon.png" />
  <link rel="manifest" href="/manifest.webmanifest" />
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Baloo+2:wght@500;600&display=swap");
    :root {
      color-scheme: light dark;
      font-family: "Baloo 2", "Trebuchet MS", "Segoe UI", sans-serif;
      --teal: #2d9cdb;
      --yellow: #ffd166;
      --green: #06d6a0;
      --pink: #ff66c4;
      --bg: #f9fafb;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: #102541;
    }

    .top-nav {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.85rem;
      padding: 0.75rem;
      background: rgba(255, 255, 255, 0.85);
      border-bottom: 1px solid rgba(16, 37, 65, 0.08);
    }

    .top-nav a {
      text-decoration: none;
      font-weight: 600;
      color: #0b2a4a;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
    }

    header {
      background: linear-gradient(120deg, var(--teal), var(--pink));
      color: #fff;
      padding: 2.5rem 1rem;
      text-align: center;
    }

    header h1 {
      margin: 0 0 0.5rem;
      font-size: clamp(2rem, 5vw, 3.2rem);
    }

    header p {
      margin: 0 auto;
      max-width: 40rem;
      font-size: 1.1rem;
    }

    main {
      padding: 2rem clamp(1rem, 3vw, 3rem);
      display: grid;
      gap: 2rem;
    }

    section {
      background: #fff;
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 10px 30px rgba(16, 37, 65, 0.08);
    }

    h2 {
      margin-top: 0;
      color: var(--teal);
    }

    ul.tips {
      list-style: "⭐ ";
      padding-left: 1rem;
      margin: 0;
      display: grid;
      gap: 0.75rem;
    }

    button, input[type="number"], input[type="text"] {
      font: inherit;
      padding: 0.65rem 1rem;
      border-radius: 999px;
      border: 2px solid transparent;
    }

    button {
      background: var(--green);
      color: #043326;
      cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 5px 16px rgba(6, 214, 160, 0.35);
    }

    button.secondary {
      background: var(--yellow);
      color: #4a3410;
    }

    .table-wrapper {
      overflow-x: auto;
      margin: 1rem auto 0;
      max-width: min(640px, 100%);
      display: none;
    }

    table {
      border-collapse: collapse;
      min-width: 24rem;
      width: 100%;
      font-size: clamp(0.8rem, 1vw + 0.6rem, 1rem);
    }

    th, td {
      border: 1px solid #e3e8ef;
      padding: 0.45rem;
      text-align: center;
      cursor: pointer;
      user-select: none;
    }

    th {
      background: var(--teal);
      color: #fff;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    th.row-header {
      position: sticky;
      left: 0;
      background: #25a5d2;
      color: #fff;
      z-index: 2;
    }

    th.corner-cell {
      position: sticky;
      left: 0;
      z-index: 3;
      background: #1a7bb3;
    }

    tr:nth-child(odd) td {
      background: #f4fbff;
    }

    .row-active {
      background: #fff6d5 !important;
    }

    .col-active {
      background: #e8fbff !important;
    }

    td.cell-focus {
      background: #ffe3fb !important;
      box-shadow: inset 0 0 0 3px rgba(255, 102, 196, 0.5);
      transform: scale(1.03);
    }

    th.row-header.row-active,
    th.col-header.col-active {
      color: #0c253f !important;
    }

    th.col-header.col-active {
      background: #d6f3ff !important;
    }

    .card-grid {
      display: grid;
      gap: 1.5rem;
    }

    @media (min-width: 720px) {
      .card-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .card {
      border: 2px dashed rgba(45, 156, 219, 0.4);
      border-radius: 1rem;
      padding: 1.25rem;
      background: #fefefe;
    }

    .feedback {
      margin-top: 0.75rem;
      font-weight: bold;
      min-height: 1.5rem;
    }

    .stats {
      margin-top: 0.5rem;
      color: #425466;
      font-size: 0.95rem;
    }

    .question {
      font-size: 1.4rem;
      font-weight: bold;
      margin-bottom: 0.75rem;
    }
  </style>
</head>
<body>
  <div class="top-nav">
    <a href="../../index.html">← Back to the Nily Adventure Hub</a>
  </div>
  <header>
    <h1>Multiply Magic</h1>
    <p>Hey Nina and Lily! Mix tips, peek-a-boo charts, and quick-fire puzzles to level up your 12×12 multiplication mastery.</p>
  </header>

  <main>
    <section>
      <h2>Mini math puzzles</h2>
      <div class="card-grid">
        <div class="card" id="flashCard">
          <h3>Flash Quiz</h3>
          <p>How fast can you answer?</p>
          <div class="question" id="flashQuestion"></div>
          <label>
            Your answer
            <input type="number" id="flashAnswer" placeholder="Type the product" min="0" />
          </label>
          <div style="display:flex;gap:0.5rem;margin-top:0.75rem;flex-wrap:wrap;">
            <button id="flashCheck">Check answer</button>
            <button id="flashNew" class="secondary">New question</button>
          </div>
          <div class="feedback" id="flashFeedback"></div>
          <div class="stats" id="flashStats"></div>
        </div>

        <div class="card" id="missingCard">
          <h3>Missing Number Mystery</h3>
          <p>Fill in the blank to complete the fact.</p>
          <div class="question" id="missingPrompt"></div>
          <label>
            Missing number
            <input type="number" id="missingAnswer" placeholder="?" min="0" />
          </label>
          <div style="display:flex;gap:0.5rem;margin-top:0.75rem;flex-wrap:wrap;">
            <button id="missingCheck">Check puzzle</button>
            <button id="missingNew" class="secondary">Try another</button>
          </div>
          <div class="feedback" id="missingFeedback"></div>
        </div>
      </div>
    </section>

    <section>
      <div style="display:flex;justify-content:space-between;align-items:center;gap:1rem;flex-wrap:wrap;">
        <h2 style="margin:0;">Multiplication Table</h2>
        <button id="toggleTableBtn" class="secondary">Show the table</button>
      </div>
      <div class="table-wrapper" id="tableWrapper">
        <table id="timesTable"></table>
      </div>
    </section>
  </main>

  <script>
    const tableWrapper = document.getElementById("tableWrapper");
    const toggleTableBtn = document.getElementById("toggleTableBtn");
    const timesTable = document.getElementById("timesTable");
    const highlightState = { row: null, col: null };

    function buildTable() {
      timesTable.innerHTML = "";
      const size = 12;
      const theadRow = document.createElement("tr");
      const corner = document.createElement("th");
      corner.textContent = "×";
      corner.classList.add("corner-cell");
      theadRow.appendChild(corner);

      for (let i = 1; i <= size; i++) {
        const th = document.createElement("th");
        th.textContent = i;
        th.dataset.col = i;
        th.classList.add("col-header");
        theadRow.appendChild(th);
      }
      timesTable.appendChild(theadRow);

      for (let row = 1; row <= size; row++) {
        const tr = document.createElement("tr");
        const rowHeader = document.createElement("th");
        rowHeader.textContent = row;
        rowHeader.dataset.row = row;
        rowHeader.classList.add("row-header");
        tr.appendChild(rowHeader);

        for (let col = 1; col <= size; col++) {
          const td = document.createElement("td");
          td.textContent = row * col;
          td.dataset.row = row;
          td.dataset.col = col;
          td.classList.add("table-cell");
          tr.appendChild(td);
        }
        timesTable.appendChild(tr);
      }
    }

    function applyHighlightState() {
      timesTable.querySelectorAll('[data-row]').forEach((cell) => {
        const rowVal = Number(cell.dataset.row);
        cell.classList.toggle("row-active", highlightState.row === rowVal);
      });
      timesTable.querySelectorAll('[data-col]').forEach((cell) => {
        const colVal = Number(cell.dataset.col);
        cell.classList.toggle("col-active", highlightState.col === colVal);
      });
      timesTable.querySelectorAll("td.table-cell").forEach((cell) => {
        const rowVal = Number(cell.dataset.row);
        const colVal = Number(cell.dataset.col);
        const focused = highlightState.row === rowVal && highlightState.col === colVal;
        cell.classList.toggle("cell-focus", focused);
      });
    }

    function handleTableTap(evt) {
      const cell = evt.target.closest("th, td");
      if (!cell || !timesTable.contains(cell)) return;

      if (cell.classList.contains("row-header")) {
        const rowVal = Number(cell.dataset.row);
        highlightState.row = highlightState.row === rowVal ? null : rowVal;
      } else if (cell.classList.contains("col-header")) {
        const colVal = Number(cell.dataset.col);
        highlightState.col = highlightState.col === colVal ? null : colVal;
      } else if (cell.dataset.row && cell.dataset.col) {
        const rowVal = Number(cell.dataset.row);
        const colVal = Number(cell.dataset.col);
        const hasRow = highlightState.row !== null;
        const hasCol = highlightState.col !== null;

        if (hasRow && !hasCol) {
          highlightState.col = colVal;
        } else if (!hasRow && hasCol) {
          highlightState.row = rowVal;
        } else {
          const sameCell = highlightState.row === rowVal && highlightState.col === colVal;
          highlightState.row = sameCell ? null : rowVal;
          highlightState.col = sameCell ? null : colVal;
        }
      } else {
        highlightState.row = null;
        highlightState.col = null;
      }
      applyHighlightState();
    }

    toggleTableBtn.addEventListener("click", () => {
      const visible = tableWrapper.style.display === "block";
      tableWrapper.style.display = visible ? "none" : "block";
      toggleTableBtn.textContent = visible ? "Show the table" : "Hide the table";
    });

    buildTable();
    applyHighlightState();
    timesTable.addEventListener("click", handleTableTap);

    // Flash quiz logic
    const flashQuestionEl = document.getElementById("flashQuestion");
    const flashAnswerEl = document.getElementById("flashAnswer");
    const flashFeedbackEl = document.getElementById("flashFeedback");
    const flashStatsEl = document.getElementById("flashStats");
    const flashState = { a: 0, b: 0, total: 0, correct: 0 };

    function newFlashQuestion() {
      flashState.a = Math.ceil(Math.random() * 12);
      flashState.b = Math.ceil(Math.random() * 12);
      flashQuestionEl.textContent = `${flashState.a} × ${flashState.b} = ?`;
      flashAnswerEl.value = "";
      flashAnswerEl.focus();
      flashFeedbackEl.textContent = "";
    }

    function updateFlashStats() {
      flashStatsEl.textContent = `Solved ${flashState.correct} of ${flashState.total} so far`;
    }

    document.getElementById("flashCheck").addEventListener("click", () => {
      const guess = Number(flashAnswerEl.value);
      if (!Number.isFinite(guess)) {
        flashFeedbackEl.textContent = "Type a number to try!";
        return;
      }
      flashState.total += 1;
      if (guess === flashState.a * flashState.b) {
        flashState.correct += 1;
        flashFeedbackEl.textContent = "Great job!";
        setTimeout(newFlashQuestion, 700);
      } else {
        flashFeedbackEl.textContent = `Almost! ${flashState.a} × ${flashState.b} = ${flashState.a * flashState.b}`;
      }
      updateFlashStats();
    });

    document.getElementById("flashNew").addEventListener("click", () => {
      newFlashQuestion();
    });

    // Missing number puzzle
    const missingPrompt = document.getElementById("missingPrompt");
    const missingAnswerInput = document.getElementById("missingAnswer");
    const missingFeedback = document.getElementById("missingFeedback");
    const missingState = { solution: 0 };

    function newMissingPuzzle() {
      const a = Math.ceil(Math.random() * 12);
      const b = Math.ceil(Math.random() * 12);
      const missing = Math.floor(Math.random() * 3); // 0: first, 1: second, 2: product
      let promptText = "";

      if (missing === 0) {
        missingState.solution = a;
        promptText = `? × ${b} = ${a * b}`;
      } else if (missing === 1) {
        missingState.solution = b;
        promptText = `${a} × ? = ${a * b}`;
      } else {
        missingState.solution = a * b;
        promptText = `${a} × ${b} = ?`;
      }
      missingPrompt.textContent = promptText;
      missingAnswerInput.value = "";
      missingFeedback.textContent = "";
      missingAnswerInput.focus();
    }

    document.getElementById("missingCheck").addEventListener("click", () => {
      const guess = Number(missingAnswerInput.value);
      if (!Number.isFinite(guess)) {
        missingFeedback.textContent = "Type the number you think fits!";
        return;
      }
      if (guess === missingState.solution) {
        missingFeedback.textContent = "You cracked the code!";
        setTimeout(newMissingPuzzle, 700);
      } else {
        missingFeedback.textContent = "Not yet—peek at the table for clues!";
      }
    });

    document.getElementById("missingNew").addEventListener("click", newMissingPuzzle);

    // Start with table hidden for peek-a-boo effect and load puzzles
    toggleTableBtn.click();
    newFlashQuestion();
    newMissingPuzzle();
  </script>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').catch((err) => {
          console.error('Service worker registration failed:', err);
        });
      });
    }
  </script>
</body>
</html>
